<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VarDict SV Detection Workflow - FGFR1 ITD</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        /* Main workflow container */
        .workflow {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        /* Section styling */
        .section {
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        
        /* Region extension visual */
        .region-box {
            background: white;
            border: 2px solid #e74c3c;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }
        
        .extension-arrow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .arrow-left, .arrow-right {
            flex: 1;
            height: 3px;
            background: #e74c3c;
            position: relative;
        }
        
        .arrow-left::before {
            content: '';
            position: absolute;
            left: 0;
            top: -5px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 10px solid #e74c3c;
        }
        
        .arrow-right::after {
            content: '';
            position: absolute;
            right: 0;
            top: -5px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 10px solid #e74c3c;
        }
        
        .center-box {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        
        /* Tier boxes */
        .tier-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .tier {
            flex: 1;
            border: 3px solid #27ae60;
            border-radius: 8px;
            padding: 20px;
            background: white;
        }
        
        .tier.fallback {
            border-color: #f39c12;
        }
        
        .tier-header {
            font-size: 18px;
            font-weight: bold;
            color: white;
            background: #27ae60;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .tier.fallback .tier-header {
            background: #f39c12;
        }
        
        /* Step boxes */
        .step {
            background: #ecf0f1;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .step-number {
            display: inline-block;
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .step-content {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
            margin-left: 40px;
        }
        
        /* Search hierarchy */
        .hierarchy {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }
        
        .hierarchy-level {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #9b59b6;
            border-radius: 5px;
            padding: 15px;
            position: relative;
        }
        
        .level-number {
            background: #9b59b6;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .level-content {
            flex: 1;
        }
        
        .level-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .level-desc {
            color: #555;
            font-size: 14px;
        }
        
        /* Code blocks */
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .highlight {
            color: #f39c12;
            font-weight: bold;
        }
        
        /* FGFR1 specific example */
        .example-box {
            background: #fff5e6;
            border: 2px dashed #f39c12;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .example-title {
            font-size: 18px;
            font-weight: bold;
            color: #d68910;
            margin-bottom: 15px;
        }
        
        /* Genomic region visualization */
        .genomic-viz {
            margin: 20px 0;
        }
        
        .gene-bar {
            height: 40px;
            background: #3aa9f4;
            border-radius: 20px;
            position: relative;
            margin: 0;
            margin-top: 60px;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-weight: bold;
        }
        
        .breakpoint {
            position: absolute;
            width: 3px;
            height: 50px;
            background: #e7c49b;
            top: -15px;
        }
        
        .breakpoint-label {
            position: absolute;
            top: -30px;
            font-size: 12px;
            color: #7841d7;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .bp-5prime {
            left: 30%;
        }
        
        .bp-3prime {
            left: 85%;
        }
        
        /* Key features box */
        .features {
            background: #e8f5e9;
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .feature-item {
            display: flex;
            align-items: start;
            margin: 10px 0;
        }
        
        .feature-icon {
            background: #27ae60;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        /* Flow arrows between sections */
        .flow-arrow {
            text-align: center;
            font-size: 30px;
            color: #3498db;
            margin: 10px 0;
        }
        
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>VarDict Structural Variant Detection Workflow</h1>
        <div class="subtitle">FGFR1 Internal Tandem Duplication (ITD) Detection Algorithm</div>
        
        <!-- Step 0: Region Extension -->
        <div class="section">
            <div class="section-title">Region Extension (-x parameter)</div>
            
            <div class="region-box">
                <div style="text-align: center; font-weight: bold; color: #2c3e50; margin-bottom: 10px;">
                    Search Space Expansion
                </div>
                <div class="extension-arrow">
                    <div class="arrow-left"></div>
                    <div class="center-box">Given BED Region<br/>FGFR1 locus</div>
                    <div class="arrow-right"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <span style="color: #e74c3c; font-weight: bold;">‚Üê 1200bp (default) + x bp</span>
                    <span style="margin: 0 20px;">|</span>
                    <span style="color: #e74c3c; font-weight: bold;">1200bp (default) + x bp ‚Üí</span>
                </div>
            </div>
            
            <div class="code-block">
# Default VarDict behavior:<br/>
<span class="highlight">-Y 1200</span>  # Reference extension for building lookup table (default)<br/>
<br/>
# User-specified extension:<br/>
<span class="highlight">-x 5000</span>  # Additional extension for SV search space<br/>
<br/>
<span style="color: #27ae60;"># Total extension per side: 1200 + 5000 = 6200 bp</span><br/>
<span style="color: #27ae60;"># This is CRITICAL for detecting ~5kb FGFR1 ITD</span>
            </div>
            
            <div class="example-box">
                <div class="example-title">FGFR1 ITD Example (GRCh38):</div>
                <div style="font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;">
                    <strong>Given BED:</strong> chr8:38,268,656-38,326,352 (59 kb, FGFR1 exons 1-20)<br/>
                    <strong>Default extension:</strong> chr8:38,267,456-38,327,552 (+1200 bp each side)<br/>
                    <strong>With -x 5000:</strong> chr8:38,261,800-38,333,200 (+6200 bp each side = 71.4 kb)<br/>
                    <br/>
                    <strong style="color: #e74c3c;">Why this matters:</strong><br/>
                    ‚Ä¢ 5' breakpoint at exon 9/10: ~38,286,150<br/>
                    ‚Ä¢ 3' breakpoint at exon 18: ~38,315,650<br/>
                    ‚Ä¢ Distance: <strong>~29.5 kb</strong> ‚Üí Requires extended search space!
                </div>
            </div>
        </div>
        
        <div class="flow-arrow">‚Üì</div>
        
        <!-- Two-Tier Detection System -->
        <div class="section">
            <div class="section-title">Two-Tier SV Detection Algorithm</div>
            
            <div class="tier-container">
                <!-- Tier 1 -->
                <div class="tier">
                    <div class="tier-header">TIER 1: Soft-Clipped Read Consensus (Primary)</div>
                    
                    <div class="step">
                        <div class="step-title">
                            <span class="step-number">1</span>
                            Consensus Sequence Derivation
                        </div>
                        <div class="step-content">
                            ‚Ä¢ Collect all reads with soft-clipping at same genomic location<br/>
                            ‚Ä¢ Build consensus from clipped portions<br/>
                            ‚Ä¢ For FGFR1 ITD: consensus from exon 9/10 boundary AND exon 18 region<br/>
                            ‚Ä¢ Requires sufficient coverage and clipping signal
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-title">
                            <span class="step-number">2</span>
                            Hash Table-Based Rapid Mapping
                        </div>
                        <div class="step-content">
                            <strong>Algorithm:</strong><br/>
                            ‚Ä¢ Build hash table of <strong>17 bp</strong> and <strong>11 bp</strong> seeds from reference<br/>
                            ‚Ä¢ Use only <strong>unique seeds</strong> to avoid false positives<br/>
                            ‚Ä¢ Query consensus sequence against hash table<br/>
                            ‚Ä¢ <strong>O(1) lookup time</strong> vs O(n) scanning<br/>
                            <br/>
                            <strong>Seed selection rationale:</strong><br/>
                            ‚Ä¢ 17bp seeds: Sufficient for unique genomic mapping<br/>
                            ‚Ä¢ 11bp seeds: Backup for low-complexity regions<br/>
                            ‚Ä¢ Excludes repetitive elements automatically
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-title">
                            <span class="step-number">3</span>
                            Breakpoint Refinement
                        </div>
                        <div class="step-content">
                            <strong>A. 5' Shift Adjustment:</strong><br/>
                            ‚Ä¢ Account for microhomology around breakpoint<br/>
                            ‚Ä¢ Perform 5' adjustments per HGVS recommendations<br/>
                            ‚Ä¢ Ensure precise breakpoint reporting<br/>
                            <br/>
                            <strong>B. Allele Frequency Estimation:</strong><br/>
                            ‚Ä¢ Count supporting split reads<br/>
                            ‚Ä¢ Count spanning read pairs<br/>
                            ‚Ä¢ Calculate variant allele fraction (VAF)<br/>
                            <br/>
                            <strong>C. SVTYPE Assignment:</strong><br/>
                            ‚Ä¢ Analyze orientation and position<br/>
                            ‚Ä¢ Classify as DEL, DUP, INV, etc.<br/>
                            ‚Ä¢ For FGFR1: Classified as <strong>DUP</strong> (duplication)
                        </div>
                    </div>
                </div>
                
                <!-- Tier 2 -->
                <div class="tier fallback">
                    <div class="tier-header">TIER 2: Discordant Pair Fallback</div>
                    
                    <div style="padding: 15px; background: #fff5e6; border-radius: 5px; margin-bottom: 15px;">
                        <strong style="color: #d68910;">When Tier 1 Fails:</strong><br/>
                        ‚Ä¢ No soft-clipped reads found<br/>
                        ‚Ä¢ Low coverage at breakpoints<br/>
                        ‚Ä¢ Insert sizes don't span well<br/>
                        ‚Ä¢ Aligner didn't soft-clip appropriately
                    </div>
                    
                    <div class="step">
                        <div class="step-title">
                            <span class="step-number" style="background: #f39c12;">1</span>
                            Cluster Discordant Mates
                        </div>
                        <div class="step-content">
                            ‚Ä¢ Identify read pairs with abnormal:<br/>
                            &nbsp;&nbsp;- Insert size (distance)<br/>
                            &nbsp;&nbsp;- Orientation (F/R, F/F, R/R)<br/>
                            ‚Ä¢ Cluster discordant pairs by genomic position<br/>
                            ‚Ä¢ Minimum cluster size threshold for confidence
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-title">
                            <span class="step-number" style="background: #f39c12;">2</span>
                            Estimate Breakpoints
                        </div>
                        <div class="step-content">
                            ‚Ä¢ Infer approximate breakpoint locations from mate positions<br/>
                            ‚Ä¢ Less precise than soft-clip method<br/>
                            ‚Ä¢ Estimate allele frequency from discordant mate count<br/>
                            ‚Ä¢ Determine SV type from orientation patterns
                        </div>
                    </div>
                    
                    <div style="padding: 15px; background: #ffe6e6; border-radius: 5px; margin-top: 15px; border: 2px dashed #e74c3c;">
                        <strong style="color: #c0392b;">‚ö† Limitations:</strong><br/>
                        ‚Ä¢ Lower precision breakpoints<br/>
                        ‚Ä¢ Cannot reconstruct variant sequence<br/>
                        ‚Ä¢ May miss events within insert size<br/>
                        ‚Ä¢ For FGFR1 ITD: Less effective for ~5kb events
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flow-arrow">‚Üì</div>
        
        <!-- Search Space Hierarchy -->
        <div class="section">
            <div class="section-title">Search Space Hierarchy (Distance-Based Strategy)</div>
            
            <div class="hierarchy">
                <div class="hierarchy-level">
                    <div class="level-number">1</div>
                    <div class="level-content">
                        <div class="level-title">Within 125 bp (Small Indels)</div>
                        <div class="level-desc">
                            <strong>Method:</strong> Ungapped alignment with ‚â§3 mismatches allowed<br/>
                            <strong>Use case:</strong> Simple insertions/deletions<br/>
                            <strong>Computational cost:</strong> Very low
                        </div>
                    </div>
                </div>
                
                <div class="hierarchy-level">
                    <div class="level-number">2</div>
                    <div class="level-content">
                        <div class="level-title">Within 5 kb of Given Region (Medium SVs)</div>
                        <div class="level-desc">
                            <strong>Method:</strong> Build 17bp + 11bp seed hash tables from extended reference<br/>
                            <strong>Use case:</strong> Intragenic duplications, deletions, inversions<br/>
                            <strong>FGFR1 ITD:</strong> Falls into this category (~5 kb duplication)<br/>
                            <strong>Computational cost:</strong> Moderate (hash table lookup: O(1))
                        </div>
                    </div>
                </div>
                
                <div class="hierarchy-level">
                    <div class="level-number">3</div>
                    <div class="level-content">
                        <div class="level-title">Beyond 5 kb (Large SVs)</div>
                        <div class="level-desc">
                            <strong>Method:</strong> Use discordant mate pair guidance exclusively<br/>
                            <strong>Use case:</strong> Large deletions, translocations, distant rearrangements<br/>
                            <strong>Strategy:</strong> Search only in regions suggested by mate alignment<br/>
                            <strong>Computational cost:</strong> High (requires mate pair analysis)
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flow-arrow">‚Üì</div>
        
        <!-- FGFR1 ITD Specific Application -->
        <div class="section">
            <div class="section-title">FGFR1 ITD Detection: Workflow Application</div>
            
            <div class="genomic-viz">
                <div style="font-weight: bold; margin-bottom: 10px; color: #2c3e50;">
                    FGFR1 Genomic Structure and Variant Distribution
                </div>
                <div class="exon-structure">
                    <!-- <span style="position: absolute; left: 10px;">Exons 1-9</span>
                    <span style="position: absolute; right: 10px;">Exons 18-20</span>
                    <div class="breakpoint bp-5prime">
                        <div class="breakpoint-label">5' Breakpoint (Exon 9/10)<br/>(~38.286 Mb)</div>
                    </div>
                    <div class="breakpoint bp-3prime">
                        <div class="breakpoint-label">3' Breakpoint (Exon 18)<br/>(~38.316 Mb)</div>
                    </div> -->
                    <img src="FGFR1_ITD_distribution_pecan_db.png" alt="FGFR1 ITD Distribution" style="width: 100%; height: auto; border-radius: 5px; margin-top: 10px;">
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <div style="display: inline-block; background: #fff5e6; padding: 10px 20px; border-radius: 5px; border: 2px solid #f39c12;">
                        <strong>Duplicated Region:</strong> Exons 10-18 (~5 kb)<br/>
                        <strong>Result:</strong> Two tandem tyrosine kinase domains (TKD-1 and TKD-2)
                    </div>
                </div>
            </div>
            
            <div class="features">
                <div style="font-weight: bold; color: #27ae60; margin-bottom: 15px; font-size: 16px;">
                    ‚úì Why VarDict Excels at FGFR1 ITD Detection
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">1</div>
                    <div>
                        <strong>Sequence Reconstruction:</strong> VarDict reconstructs the variant sequence from soft-clipped reads rather than just measuring insert size differences
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">2</div>
                    <div>
                        <strong>Hash Table Efficiency:</strong> O(1) lookup time enables rapid identification of where duplicated sequence maps within the gene
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">3</div>
                    <div>
                        <strong>Extended Search Space:</strong> The -x parameter ensures both breakpoints (29.5 kb apart) are within the hash table search space
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">4</div>
                    <div>
                        <strong>Precise Breakpoints:</strong> Soft-clip consensus method provides exact breakpoint coordinates with microhomology adjustment
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">5</div>
                    <div>
                        <strong>Accurate VAF:</strong> Counts both split reads and spanning pairs for reliable allele frequency estimation
                    </div>
                </div>
            </div>
            
            <div class="code-block" style="margin-top: 20px;">
<span style="color: #27ae60;"># Recommended VarDict command for FGFR1 ITD detection:</span><br/>
<br/>
vardict-java -G hg38.fa -f 0.01 -N sample_name \<br/>
&nbsp;&nbsp;<span class="highlight">-x 5000</span> \  <span style="color: #27ae60;"># Critical: extend search 5kb for ITD detection</span><br/>
&nbsp;&nbsp;-k 1 \      <span style="color: #27ae60;"># Enable realignment for accurate AF</span><br/>
&nbsp;&nbsp;-c 1 -S 2 -E 3 -g 4 \<br/>
&nbsp;&nbsp;fgfr1_itd.bed sample.bam<br/>
<br/>
<span style="color: #27ae60;"># Key parameters explained:</span><br/>
<span style="color: #27ae60;"># -x 5000: Extends search 5kb beyond default 1200bp</span><br/>
<span style="color: #27ae60;"># -f 0.01: Detects low-frequency ITDs (1% VAF)</span><br/>
<span style="color: #27ae60;"># -k 1: Performs local realignment around variants</span>
            </div>
        </div>
        
        <!-- Summary Box -->
        <div style="background: #e3f2fd; border: 3px solid #2196f3; border-radius: 8px; padding: 20px; margin-top: 30px;">
            <div style="font-size: 20px; font-weight: bold; color: #1976d2; margin-bottom: 15px; text-align: center;">
                üéØ Key Takeaways
            </div>
            <div style="line-height: 1.8; color: #2c3e50;">
                <strong>1. Tier 1 (Soft-Clip) is Primary:</strong> Most accurate method with precise breakpoints and sequence reconstruction<br/>
                <strong>2. Tier 2 (Discordant) is Fallback:</strong> Used when soft-clipping signal is insufficient or absent<br/>
                <strong>3. Distance-Based Hierarchy:</strong> Search strategy adapts to expected SV size (125bp ‚Üí 5kb ‚Üí beyond)<br/>
                <strong>4. Hash Table Innovation:</strong> 17bp/11bp unique seeds enable rapid O(1) mapping of consensus sequences<br/>
                <strong>5. Extension is Critical:</strong> The -x parameter determines how far VarDict can "see" for breakpoint matching
            </div>
        </div>
    </div>
</body>
</html>